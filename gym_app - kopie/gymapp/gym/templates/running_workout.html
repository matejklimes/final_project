<!-- templates/running_workout.html -->
{% extends 'base_generic.html' %}
{% load static %}

{% block title %}Running Workout{% endblock %}
{% block head %}
<link rel="stylesheet" href="{% static 'css/running_workout.css' %}">
{% endblock %}

{% block content %}
    <h1 class="mt-4 mb-4">Running Workout</h1>

    <!-- Form for adding/editing workouts -->
    <form method="post" id="workout-form">
        {% csrf_token %}
        {{ form.name }}

        <!-- Dropdown for choosing exercises -->
        <select id="exercise-select" name="exercise">
            <!-- Option for the default prompt -->
            <option value="" disabled selected>Select an exercise</option>
            <!-- Options for each exercise fetched dynamically -->
        </select>

        <!-- Add exercise button -->
        <button type="button" id="add-exercise">Add Exercise</button>

        <!-- Exercise list placeholder -->
        <div id="exercise-list-placeholder"></div>

        <!-- Hidden input field to store selected exercise IDs -->
        <input type="hidden" name="selected_exercises" id="selected-exercises" value="">

        <button type="submit">Finish Workout</button>
    </form>
{% endblock %}
{% block scripts %}
    <script>
        // Fetch exercises from the server using AJAX
        function fetchExercises() {
            fetch('{% url "exercise_list_json" %}')
                .then(response => response.json())
                .then(data => {
                    // Populate the dropdown with exercises
                    const selectElement = document.getElementById('exercise-select');
                    selectElement.innerHTML = '<option value="" disabled selected>Select an exercise</option>' +
                        data.map(exercise => `<option value="${exercise.id}">${exercise.name}</option>`).join('');
                })
                .catch(error => console.error('Error fetching exercises:', error));
        }

        // Function to add selected exercises to the list
        function addSelectedExercise() {
            const selectElement = document.getElementById('exercise-select');
            const selectedExerciseIndex = selectElement.selectedIndex;

            if (selectedExerciseIndex !== -1) {
                const selectedOption = selectElement.options[selectedExerciseIndex];
                const exerciseName = selectedOption.textContent;

                // Create a new paragraph element with the exercise name and append it to the placeholder
                const exerciseListPlaceholder = document.getElementById('exercise-list-placeholder');
                const newExerciseElement = document.createElement('p');
                newExerciseElement.textContent = exerciseName;
                exerciseListPlaceholder.appendChild(newExerciseElement);

                // Store the selected exercise ID in the hidden input field
                const selectedExercisesInput = document.getElementById('selected-exercises');
                selectedExercisesInput.value += selectedOption.value + ',';
            }
        }

        // Event listener for the "Add Exercise" button
        document.getElementById('add-exercise').addEventListener('click', addSelectedExercise);

        // Event listener for the form submission
        document.getElementById('workout-form').addEventListener('submit', function () {
            // Ensure at least one exercise is selected before submitting the form
            if (document.getElementById('selected-exercises').value === '') {
                alert('Please add at least one exercise to the workout.');
                event.preventDefault();
            }
        });

        // Fetch exercises when the page loads
        fetchExercises();
    </script>
{% endblock %}
